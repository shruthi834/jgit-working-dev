@PostMapping("/delete")

    public String deleteAndCommit(@RequestParam String fileName) throws IOException, GitAPIException {

        Repository repository = new FileRepositoryBuilder()

                .setGitDir(new File(repositoryPath + "/.git"))

                .build();

        Git git = new Git(repository);

 

        // Delete the specified file from the working directory

        File fileToDelete = new File(repositoryPath, fileName);

        if (!fileToDelete.delete()) {

            return "File not found: " + fileName;

        }

 

        // Stage the deletion

        git.rm().addFilepattern(fileName).call();

 

        // Commit changes

        PersonIdent personIdent = new PersonIdent("ryeso02", "ryeso@opteamix.com");

        git.commit()

                .setAuthor(personIdent)

                .setCommitter(personIdent)

                .setMessage("Deleted file: " + fileName)

                .call();

 

        // Push to remote repository using Personal Access Token

        String personalAccessToken = "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"; // Replace with your actual PAT

        pushToRemote(git, personalAccessToken);

 

        git.close();

        repository.close();

 

        return "File deleted, changes committed, and pushed to remote.";

    }

 

    // Helper method to push changes to remote repository

    private void pushToRemote(Git git, String personalAccessToken) throws GitAPIException {

        git.push()

                .setRemote(remoteRepositoryUrl)

                .setCredentialsProvider(new UsernamePasswordCredentialsProvider(personalAccessToken, ""))

                .call();

    }
